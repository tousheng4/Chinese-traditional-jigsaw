# agents.md

## 1. 项目概述
本项目拟开发一款 **传统文化风格的拼图游戏（iOS / iPadOS）**，以“可玩、可赏、可学”为核心体验，将传统视觉艺术以拼图交互的方式重新组织，让用户在指尖的拆解与复原之间，完成一次与经典图像的温柔相遇。

拼图主题包含但不限于：
- **传统年画拼图**（吉祥寓意、节俗叙事）
- **京剧脸谱拼图**（角色谱系、色彩象征）
- **敦煌壁画拼图**（线描与设色、飞天与供养人题材）
- **国画拼图**（山水、花鸟、人物等）

技术栈明确为：**SwiftUI**（优先采用现代 iOS 开发范式，配合 Swift Concurrency / Combine 视情况引入）。

---

## 2. 产品目标与体验原则
### 2.1 核心目标
- 提供稳定流畅、审美统一的拼图玩法（拖拽、吸附、完成反馈）。
- 以主题化内容策展的方式组织关卡，让传统艺术“可进入、可亲近、可反复把玩”。
- 支持多难度与多拼图规模，兼顾休闲与挑战。

### 2.2 体验原则
- **美术先行**：界面与动画为内容服务，不喧宾夺主。
- **交互克制**：反馈清晰、节奏舒缓，避免过度刺激。
- **学习轻盈**：知识点以轻量卡片呈现，不打断核心玩法。
- **离线可用**：基础关卡与玩法不依赖网络。

---

## 3. 功能需求（MVP → 可扩展）
### 3.1 MVP 功能
1. **主题/关卡选择**
   - 主题分类入口：年画 / 脸谱 / 敦煌 / 国画
   - 关卡列表：缩略图、名称、难度、完成状态
2. **拼图玩法**
   - 将原图切分为若干块（规则网格为主；后续可扩展异形块）
   - 拖拽移动拼图块；靠近目标位置触发 **吸附（snap）** 与 **锁定**
   - 支持打乱初始布局（随机散布或集中堆叠）
3. **难度系统**
   - 建议至少三档：简单 / 标准 / 困难（对应 3x3、4x4、6x6 或等价规模）
4. **进度与结果**
   - 计时（可选开关）、步数统计
   - 完成时展示整图与简短“图像小卡”（名称、出处/风格一句话）
   - 本地持久化：已解锁/已完成/最佳记录（若启用计时）
5. **基础设置**
   - 音效/触感反馈开关
   - 辅助功能：高对比度、减少动态效果（遵从系统设置）

### 3.2 可扩展功能（Roadmap）
- **提示系统**：显示半透明底图、突出某一块目标区域、自动归位（受限次数）
- **碎片边框/轮廓模式**：帮助入门用户
- **成就与收藏**：按主题收集“已复原画卷”
- **知识扩展**：更完整的来源说明、元素解读（例如脸谱色彩寓意）
- **异形拼图块**：更贴近传统拼图的咬合形状
- **每日一图 / 限时活动**：轻运营节奏（如节气、传统节日专题）

---

## 4. 技术与架构约束
### 4.1 平台与框架
- 平台：iOS（优先），兼容 iPadOS（自适配布局）
- UI：**SwiftUI**
- 并发：Swift Concurrency（任务、异步资源加载）
- 状态管理：MVVM（`Observable`/`@StateObject`/`@Observable` 视项目最低系统版本选择）
- 持久化：UserDefaults（MVP）→ 可平滑迁移至 CoreData/SwiftData（扩展阶段）

### 4.2 模块划分（建议）
- `AppShell`：入口、路由、全局主题（字体/色板/动效尺度）
- `Gallery`：主题与关卡列表、缩略图与解锁逻辑
- `PuzzleEngine`：切图、布局、碰撞/吸附判定、完成检测
- `Assets`：图片资源、元数据（标题、简介、版权/来源字段）
- `Persistence`：进度、记录、设置项
- `UX`：音效、触感、动画、无障碍适配
- `Testing`：单元测试/快照测试（按团队习惯）

---

## 5. 数据模型（概念层）
- `PuzzleCategory`
  - `id`, `title`, `description`, `coverImage`
- `PuzzleLevel`
  - `id`, `categoryId`, `title`, `previewImage`, `sourceInfo`, `gridSize`, `isLocked`
- `PuzzlePiece`
  - `id`, `index`, `imageCropRect`, `targetPosition`, `currentPosition`, `isLocked`
- `PuzzleProgress`
  - `levelId`, `isCompleted`, `bestTime`, `bestMoves`, `lastPlayedAt`
- `AppSettings`
  - `soundEnabled`, `hapticsEnabled`, `showGuideOverlay`, `reduceMotionOverride`

---

## 6. 关键交互与算法要点
- **切图策略**：规则网格裁剪（MVP），保持像素对齐与缩放一致性，避免模糊边缘。
- **拖拽手感**：Piece 在拖拽中高层级显示；放手后执行吸附判定。
- **吸附判定**：
  - 与 `targetPosition` 距离 < 阈值 → 自动归位并锁定
  - 阈值与缩放比例、屏幕尺寸关联（需自适配）
- **完成检测**：所有块 `isLocked == true` 或已归位计数达到总数。

---

## 7. 内容与合规要求（重要）
- 图片资源必须具备明确的 **版权/授权** 或使用可商用许可来源；元数据中保留 `sourceInfo` 字段。
- 如引入传统文物/馆藏相关图像，需记录馆藏机构与许可条款。
- App 内展示的知识卡内容避免事实性错误；必要时保留“资料来源”字段。

---

## 8. 质量标准（Definition of Done）
- 60fps 目标（主流设备），拖拽无明显掉帧或错位。
- 旋转/多尺寸下布局稳定；iPad 分屏不崩坏。
- 本地进度可靠：退出/重启不丢失。
- 无障碍：VoiceOver 可遍历主要按钮；对比度与动态效果遵从系统设置。
- 基础测试覆盖：
  - 吸附判定与完成检测的单元测试
  - 关键界面的冒烟测试（启动、选关、开始、完成）

---

## 9. Agent 分工（用于协作开发）
> 说明：下列“Agent”指可并行协作的职责角色（人或自动化智能体均可）。每个 Agent 输出物应可被直接评审与合并。

1. **Product & Content Agent（产品与内容策展）**
   - 定义主题结构、关卡节奏、难度梯度
   - 准备图片元数据：标题、简介、来源、标签
2. **SwiftUI UI Agent（界面与交互实现）**
   - 主题化视觉规范：字体、间距、动效尺度
   - 关卡列表、详情页、拼图主界面布局与动效
3. **PuzzleEngine Agent（核心玩法引擎）**
   - 切图、坐标系统、吸附逻辑、锁定与完成检测
   - 性能优化与手势冲突处理
4. **Persistence Agent（进度与设置）**
   - 进度模型设计与存储实现
   - 版本迁移策略（MVP → 扩展）
5. **QA Agent（测试与质量）**
   - 单元测试用例、边界场景（缩放、旋转、快速拖拽）
   - 可用性缺陷回归清单
6. **Release Agent（构建与发布准备）**
   - 包体优化、资源压缩策略
   - 隐私清单、权限最小化与 AppStore 元信息准备

---

## 10. 输出物清单（期望交付）
- 可运行的 SwiftUI 应用（MVP）：
  - 至少 4 个主题分类入口
  - 每类至少若干示例关卡（可先用占位素材，后续替换）
  - 拼图引擎可稳定完成一局游戏
- 文档：
  - 资源来源与许可说明（表格/README）
  - 玩法说明与扩展路线图

